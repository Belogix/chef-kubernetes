apiVersion: v1
kind: Pod
metadata:
  name: weavescope
  namespace: kube-system
spec:
  hostNetwork: true
  containers:
  - name: weavescope
    image: weaveworks/scope:<%= node[:kubernetes][:weavescope][:version] %>
    command:
    - /home/weave/entrypoint.sh
    - --probe.docker=true
    - -app.http.address <%= @listen_addr %>:<%= node[:kubernetes][:weavescope][:port] %>
    - <%= node[:kubernetes][:weavescope][:master] %>
    - <%= @listen_addr %>:<%= node[:kubernetes][:weavescope][:port] %>
    securityContext:
      privileged: true
    volumeMounts:
    - mountPath: /var/run/scope/plugins
      name: scope-plugins
      readOnly: false
    - mountPath: /var/run/docker.sock
      name: docker-sock
      readOnly: false
  volumes:
  - hostPath:
      path: /var/run/scope/plugins
    name: scope-plugins
  - hostPath:
      path: /var/run/docker.sock
    name: docker-sock
